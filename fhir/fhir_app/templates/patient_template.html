{%load static%}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patient</title>
    <link rel="stylesheet" href="{% static 'fhir_app/css/patient.css' %}">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
</head>
<body>
    <h1>{{patient_list.patient.0.resource.name.0.prefix.0}} {{patient_list.entry.0.resource.name.0.given.0}} {{patient_list.entry.0.resource.name.0.family}}</h1>
    <h2>
      <span class="material-symbols-outlined">{{patient_list.entry.0.resource.gender}}</span>
    </h2>
    <p>Birth date: {{patient_list.entry.0.resource.birthDate}}</p>

    <div class="patient-identifiers">
      <h3>Identifiers</h3>
        <ul>
          {%for identifier in patient_list.entry.0.resource.identifier%}
          <li>
            {%if identifier.type is not None%}
            <p>
              <span>{{identifier.type.coding.0.display}}: </span><span>{{identifier.value}}</span>
            </p>
            {%endif%}
          </li>
          {%endfor%}
        </ul>
    </div>
    <div class="observations">
      <table>
        <caption>
          <h3>Observations</h3>
          <form method="GET" action=".">
          <div class="form-group col-md-2 col-lg-2">
            <label for="effectiveDateTimeMin">Clinically relevant time/time-period for observation minimum</label>
            <input type="date" class="form-control" id="effectiveDateTimeMin" name="date_min">
          </div>
          <div class="form-group col-md-2 col-lg-2">
            <label for="effectiveDateTimeMin">Clinically relevant time/time-period for observation maximum</label>
            <input type="date" class="form-control" id="effectiveDateTimeMin" name="date_max">
          </div>
          <button type="submit" class="btn btn-primary">Search</button>
        </form>
        </caption>
        <th></th>
        
        <tr>
          <td>Parameter</td>
          <td>Value</td>
          <td>Unit</td>
          <td>Date</td>
        </tr>
        {%for observation in observations.entry|dictsort:"resource.code.text"%}
        <tr>
          <td> {{observation.resource.code.text}}</td>
          <td>
            {%if observation.resource.valueQuantity.value is not None%}
            {{observation.resource.valueQuantity.value}}
            {%else%}
            {{observation.resource.component.0.valueQuantity.value}}
            {%endif%}
          </td>
          <td>
            {%if observation.resource.valueQuantity.unit is not None%}
            {{observation.resource.valueQuantity.unit}}
            {%else%}
            {{observation.resource.component.0.valueQuantity.unit}}
            {%endif%} 
          </td>
          <td>
            {{observation.resource.effectiveDateTime}}
          </td>
        </tr>
        {%endfor%}
      </table>
    </div>

    <div class="medication">
      
      <table>
        {%if medication.entry is None%}
        <caption><h3>No medication received</h3></caption>
        {%else%}
        <caption><h3>Medication</h3></caption>
        
        

        <th></th>
        <tr>
          <td>Name</td>
          <td>Time</td>
        </tr>
        {%for medication in medication.entry|dictsort:"resource.authoredOn"%}
        
        <tr>
          <td>
            {{medication.resource.medicationCodeableConcept.coding.0.display}}
          </td>
          <td>
            {{medication.resource.authoredOn}}
          </td>
        </tr>
        {%endfor%}
        {%endif%}
      </table>
    </div>
    
</body>
</html>